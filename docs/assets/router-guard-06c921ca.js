import{S as V,s as w,n as H,i as F,a as k,t as G,f as J,c as X,r as L,b as Y,d as O,u as Z,p as _,e as $,g as W,h as U,j as ee,k as te,N as M,l as D}from"./index-c2cc4b23.js";import{r as E,m as re,f as se,g as ne,c as A}from"./antd-57ea9798.js";import{s as ie,u as ue}from"./utils-25a382b8.js";class ae extends V{constructor(t,e){super(),this.client=t,this.options=e,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(e)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),B(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return T(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return T(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(t,e){const s=this.options,l=this.currentQuery;if(this.options=this.client.defaultQueryOptions(t),w(s,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=s.queryKey),this.updateQuery();const u=this.hasListeners();u&&N(this.currentQuery,l,this.options,s)&&this.executeFetch(),this.updateResult(e),u&&(this.currentQuery!==l||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.updateStaleTimeout();const o=this.computeRefetchInterval();u&&(this.currentQuery!==l||this.options.enabled!==s.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)}getOptimisticResult(t){const e=this.client.getQueryCache().build(this.client,t),s=this.createResult(e,t);return ce(this,s,t)&&(this.currentResult=s,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),s}getCurrentResult(){return this.currentResult}trackResult(t){const e={};return Object.keys(t).forEach(s=>{Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(s),t[s])})}),e}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:t,...e}={}){return this.fetch({...e,meta:{refetchPage:t}})}fetchOptimistic(t){const e=this.client.defaultQueryOptions(t),s=this.client.getQueryCache().build(this.client,e);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,e))}fetch(t){var e;return this.executeFetch({...t,cancelRefetch:(e=t.cancelRefetch)!=null?e:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(t){this.updateQuery();let e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(H)),e}updateStaleTimeout(){if(this.clearStaleTimeout(),F||this.currentResult.isStale||!k(this.options.staleTime))return;const e=G(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},e)}computeRefetchInterval(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1}updateRefetchInterval(t){this.clearRefetchInterval(),this.currentRefetchInterval=t,!(F||this.options.enabled===!1||!k(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||J.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(t,e){const s=this.currentQuery,l=this.options,u=this.currentResult,o=this.currentResultState,y=this.currentResultOptions,m=t!==s,v=m?t.state:this.currentQueryInitialState,g=m?this.currentResult:this.previousQueryResult,{state:h}=t;let{dataUpdatedAt:C,error:Q,errorUpdatedAt:n,fetchStatus:i,status:a}=h,d=!1,b=!1,f;if(e._optimisticResults){const p=this.hasListeners(),P=!p&&B(t,e),K=p&&N(t,s,e,l);(P||K)&&(i=X(t.options.networkMode)?"fetching":"paused",C||(a="loading")),e._optimisticResults==="isRestoring"&&(i="idle")}if(e.keepPreviousData&&!h.dataUpdatedAt&&g!=null&&g.isSuccess&&a!=="error")f=g.data,C=g.dataUpdatedAt,a=g.status,d=!0;else if(e.select&&typeof h.data<"u")if(u&&h.data===(o==null?void 0:o.data)&&e.select===this.selectFn)f=this.selectResult;else try{this.selectFn=e.select,f=e.select(h.data),f=L(u==null?void 0:u.data,f,e),this.selectResult=f,this.selectError=null}catch(p){this.selectError=p}else f=h.data;if(typeof e.placeholderData<"u"&&typeof f>"u"&&a==="loading"){let p;if(u!=null&&u.isPlaceholderData&&e.placeholderData===(y==null?void 0:y.placeholderData))p=u.data;else if(p=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof p<"u")try{p=e.select(p),this.selectError=null}catch(P){this.selectError=P}typeof p<"u"&&(a="success",f=L(u==null?void 0:u.data,p,e),b=!0)}this.selectError&&(Q=this.selectError,f=this.selectResult,n=Date.now(),a="error");const c=i==="fetching",R=a==="loading",S=a==="error";return{status:a,fetchStatus:i,isLoading:R,isSuccess:a==="success",isError:S,isInitialLoading:R&&c,data:f,dataUpdatedAt:C,error:Q,errorUpdatedAt:n,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>v.dataUpdateCount||h.errorUpdateCount>v.errorUpdateCount,isFetching:c,isRefetching:c&&!R,isLoadingError:S&&h.dataUpdatedAt===0,isPaused:i==="paused",isPlaceholderData:b,isPreviousData:d,isRefetchError:S&&h.dataUpdatedAt!==0,isStale:x(t,e),refetch:this.refetch,remove:this.remove}}updateResult(t){const e=this.currentResult,s=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,w(s,e))return;this.currentResult=s;const l={cache:!0},u=()=>{if(!e)return!0;const{notifyOnChangeProps:o}=this.options,y=typeof o=="function"?o():o;if(y==="all"||!y&&!this.trackedProps.size)return!0;const m=new Set(y??this.trackedProps);return this.options.useErrorBoundary&&m.add("error"),Object.keys(this.currentResult).some(v=>{const g=v;return this.currentResult[g]!==e[g]&&m.has(g)})};(t==null?void 0:t.listeners)!==!1&&u()&&(l.listeners=!0),this.notify({...l,...t})}updateQuery(){const t=this.client.getQueryCache().build(this.client,this.options);if(t===this.currentQuery)return;const e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}onQueryUpdate(t){const e={};t.type==="success"?e.onSuccess=!t.manual:t.type==="error"&&!Y(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()}notify(t){O.batch(()=>{if(t.onSuccess){var e,s,l,u;(e=(s=this.options).onSuccess)==null||e.call(s,this.currentResult.data),(l=(u=this.options).onSettled)==null||l.call(u,this.currentResult.data,null)}else if(t.onError){var o,y,m,v;(o=(y=this.options).onError)==null||o.call(y,this.currentResult.error),(m=(v=this.options).onSettled)==null||m.call(v,void 0,this.currentResult.error)}t.listeners&&this.listeners.forEach(({listener:g})=>{g(this.currentResult)}),t.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function oe(r,t){return t.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&t.retryOnMount===!1)}function B(r,t){return oe(r,t)||r.state.dataUpdatedAt>0&&T(r,t,t.refetchOnMount)}function T(r,t,e){if(t.enabled!==!1){const s=typeof e=="function"?e(r):e;return s==="always"||s!==!1&&x(r,t)}return!1}function N(r,t,e,s){return e.enabled!==!1&&(r!==t||s.enabled===!1)&&(!e.suspense||r.state.status!=="error")&&x(r,e)}function x(r,t){return r.isStaleByTime(t.staleTime)}function ce(r,t,e){return e.keepPreviousData?!1:e.placeholderData!==void 0?t.isPlaceholderData:r.getCurrentResult()!==t}const q=E.createContext(!1),le=()=>E.useContext(q);q.Provider;function he(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}const de=E.createContext(he()),fe=()=>E.useContext(de),pe=(r,t)=>{(r.suspense||r.useErrorBoundary)&&(t.isReset()||(r.retryOnMount=!1))},ye=r=>{E.useEffect(()=>{r.clearReset()},[r])},me=({result:r,errorResetBoundary:t,useErrorBoundary:e,query:s})=>r.isError&&!t.isReset()&&!r.isFetching&&ie(e,[r.error,s]),ve=r=>{r.suspense&&typeof r.staleTime!="number"&&(r.staleTime=1e3)},ge=(r,t)=>r.isLoading&&r.isFetching&&!t,Re=(r,t,e)=>(r==null?void 0:r.suspense)&&ge(t,e),be=(r,t,e)=>t.fetchOptimistic(r).then(({data:s})=>{r.onSuccess==null||r.onSuccess(s),r.onSettled==null||r.onSettled(s,null)}).catch(s=>{e.clearReset(),r.onError==null||r.onError(s),r.onSettled==null||r.onSettled(void 0,s)});function Se(r,t){const e=Z({context:r.context}),s=le(),l=fe(),u=e.defaultQueryOptions(r);u._optimisticResults=s?"isRestoring":"optimistic",u.onError&&(u.onError=O.batchCalls(u.onError)),u.onSuccess&&(u.onSuccess=O.batchCalls(u.onSuccess)),u.onSettled&&(u.onSettled=O.batchCalls(u.onSettled)),ve(u),pe(u,l),ye(l);const[o]=E.useState(()=>new t(e,u)),y=o.getOptimisticResult(u);if(ue(E.useCallback(m=>{const v=s?()=>{}:o.subscribe(O.batchCalls(m));return o.updateResult(),v},[o,s]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),E.useEffect(()=>{o.setOptions(u,{listeners:!1})},[u,o]),Re(u,y,s))throw be(u,o,l);if(me({result:y,errorResetBoundary:l,useErrorBoundary:u.useErrorBoundary,query:o.getCurrentQuery()}))throw y.error;return u.notifyOnChangeProps?y:o.trackResult(y)}function Ee(r,t,e){const s=_(r,t,e);return Se(s,ae)}function Ce(r){return $({url:"/usr",...r})}function Qe(){const{usr:r,updateUsr:t,signOut:e}=W(),{isError:s,error:l,data:u}=Ee({enabled:!!r,queryKey:["usr_get"],queryFn({signal:o}){return Ce({signal:o,params:r})},initialData(){if(r)return r},initialDataUpdatedAt(){return r==null?void 0:r.loginAt},refetchInterval:1e3*60*30,retry:2,retryDelay:1e3*3});E.useEffect(()=>{u&&t(u)},[t,u]),E.useEffect(()=>{s&&(e(),re.error(l.message))},[e,s])}function Ie(){const r=U();return E.useEffect(()=>{const t=r.at(-1);if(!t)return;const{handle:e}=t,s=Reflect.get(Object(e),"title");typeof s=="string"&&(document.title=s)},[r])}var z={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(r,t){(function(e,s){r.exports=s()})(se,function(){var e={};e.version="0.2.0";var s=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};e.configure=function(n){var i,a;for(i in n)a=n[i],a!==void 0&&n.hasOwnProperty(i)&&(s[i]=a);return this},e.status=null,e.set=function(n){var i=e.isStarted();n=l(n,s.minimum,1),e.status=n===1?null:n;var a=e.render(!i),d=a.querySelector(s.barSelector),b=s.speed,f=s.easing;return a.offsetWidth,y(function(c){s.positionUsing===""&&(s.positionUsing=e.getPositioningCSS()),m(d,o(n,b,f)),n===1?(m(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout(function(){m(a,{transition:"all "+b+"ms linear",opacity:0}),setTimeout(function(){e.remove(),c()},b)},b)):setTimeout(c,b)}),this},e.isStarted=function(){return typeof e.status=="number"},e.start=function(){e.status||e.set(0);var n=function(){setTimeout(function(){e.status&&(e.trickle(),n())},s.trickleSpeed)};return s.trickle&&n(),this},e.done=function(n){return!n&&!e.status?this:e.inc(.3+.5*Math.random()).set(1)},e.inc=function(n){var i=e.status;return i?(typeof n!="number"&&(n=(1-i)*l(Math.random()*i,.1,.95)),i=l(i+n,0,.994),e.set(i)):e.start()},e.trickle=function(){return e.inc(Math.random()*s.trickleRate)},function(){var n=0,i=0;e.promise=function(a){return!a||a.state()==="resolved"?this:(i===0&&e.start(),n++,i++,a.always(function(){i--,i===0?(n=0,e.done()):e.set((n-i)/n)}),this)}}(),e.render=function(n){if(e.isRendered())return document.getElementById("nprogress");g(document.documentElement,"nprogress-busy");var i=document.createElement("div");i.id="nprogress",i.innerHTML=s.template;var a=i.querySelector(s.barSelector),d=n?"-100":u(e.status||0),b=document.querySelector(s.parent),f;return m(a,{transition:"all 0 linear",transform:"translate3d("+d+"%,0,0)"}),s.showSpinner||(f=i.querySelector(s.spinnerSelector),f&&Q(f)),b!=document.body&&g(b,"nprogress-custom-parent"),b.appendChild(i),i},e.remove=function(){h(document.documentElement,"nprogress-busy"),h(document.querySelector(s.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&Q(n)},e.isRendered=function(){return!!document.getElementById("nprogress")},e.getPositioningCSS=function(){var n=document.body.style,i="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return i+"Perspective"in n?"translate3d":i+"Transform"in n?"translate":"margin"};function l(n,i,a){return n<i?i:n>a?a:n}function u(n){return(-1+n)*100}function o(n,i,a){var d;return s.positionUsing==="translate3d"?d={transform:"translate3d("+u(n)+"%,0,0)"}:s.positionUsing==="translate"?d={transform:"translate("+u(n)+"%,0)"}:d={"margin-left":u(n)+"%"},d.transition="all "+i+"ms "+a,d}var y=function(){var n=[];function i(){var a=n.shift();a&&a(i)}return function(a){n.push(a),n.length==1&&i()}}(),m=function(){var n=["Webkit","O","Moz","ms"],i={};function a(c){return c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(R,S){return S.toUpperCase()})}function d(c){var R=document.body.style;if(c in R)return c;for(var S=n.length,I=c.charAt(0).toUpperCase()+c.slice(1),p;S--;)if(p=n[S]+I,p in R)return p;return c}function b(c){return c=a(c),i[c]||(i[c]=d(c))}function f(c,R,S){R=b(R),c.style[R]=S}return function(c,R){var S=arguments,I,p;if(S.length==2)for(I in R)p=R[I],p!==void 0&&R.hasOwnProperty(I)&&f(c,I,p);else f(c,S[1],S[2])}}();function v(n,i){var a=typeof n=="string"?n:C(n);return a.indexOf(" "+i+" ")>=0}function g(n,i){var a=C(n),d=a+i;v(a,i)||(n.className=d.substring(1))}function h(n,i){var a=C(n),d;v(n,i)&&(d=a.replace(" "+i+" "," "),n.className=d.substring(1,d.length-1))}function C(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function Q(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return e})})(z);var Oe=z.exports;const j=ne(Oe);function Pe(){const r=U();return E.useEffect(()=>(j.done(),()=>{j.start()}),[r])}const Te=["login"],Ue=r=>Te.includes(r);function xe(){const r=ee(),t=U(),[e]=te(),{usr:s}=W();return E.useMemo(()=>{const l=t[t.length-1],{id:u,pathname:o}=l;if(u==="login"){const Q=e.get("returnURL")||"/";return s?A.createElement(M,{to:Q}):r}if(Ue(u)||s)return r;const v=new URLSearchParams;v.set("returnURL",o);const h={pathname:"/login",search:v.toString()};return A.createElement(M,{to:h})},[r,t,e,s])}function Le(){const r=xe();return Ie(),Pe(),Qe(),D.jsx(D.Fragment,{children:r})}export{Le as Component};
