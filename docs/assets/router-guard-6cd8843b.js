import{S as K,s as w,n as V,i as F,a as k,t as H,f as G,c as J,r as L,b as X,d as O,u as Y,p as Z,e as U,g as _,h as $,j as ee,N as M,k as te,l as D}from"./index-1aa5fb56.js";import{r as E,f as re,g as se,c as A}from"./antd-57ea9798.js";import{u as ne}from"./use-login-b3fddcb7.js";import{s as ie,u as ue}from"./utils-f331c544.js";class ae extends K{constructor(t,e){super(),this.client=t,this.options=e,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(e)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),B(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return T(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return T(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(t,e){const s=this.options,o=this.currentQuery;if(this.options=this.client.defaultQueryOptions(t),w(s,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=s.queryKey),this.updateQuery();const u=this.hasListeners();u&&N(this.currentQuery,o,this.options,s)&&this.executeFetch(),this.updateResult(e),u&&(this.currentQuery!==o||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.updateStaleTimeout();const c=this.computeRefetchInterval();u&&(this.currentQuery!==o||this.options.enabled!==s.enabled||c!==this.currentRefetchInterval)&&this.updateRefetchInterval(c)}getOptimisticResult(t){const e=this.client.getQueryCache().build(this.client,t),s=this.createResult(e,t);return ce(this,s,t)&&(this.currentResult=s,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),s}getCurrentResult(){return this.currentResult}trackResult(t){const e={};return Object.keys(t).forEach(s=>{Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(s),t[s])})}),e}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:t,...e}={}){return this.fetch({...e,meta:{refetchPage:t}})}fetchOptimistic(t){const e=this.client.defaultQueryOptions(t),s=this.client.getQueryCache().build(this.client,e);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,e))}fetch(t){var e;return this.executeFetch({...t,cancelRefetch:(e=t.cancelRefetch)!=null?e:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(t){this.updateQuery();let e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(V)),e}updateStaleTimeout(){if(this.clearStaleTimeout(),F||this.currentResult.isStale||!k(this.options.staleTime))return;const e=H(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},e)}computeRefetchInterval(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1}updateRefetchInterval(t){this.clearRefetchInterval(),this.currentRefetchInterval=t,!(F||this.options.enabled===!1||!k(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||G.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(t,e){const s=this.currentQuery,o=this.options,u=this.currentResult,c=this.currentResultState,y=this.currentResultOptions,v=t!==s,m=v?t.state:this.currentQueryInitialState,g=v?this.currentResult:this.previousQueryResult,{state:h}=t;let{dataUpdatedAt:C,error:Q,errorUpdatedAt:n,fetchStatus:i,status:a}=h,f=!1,b=!1,d;if(e._optimisticResults){const p=this.hasListeners(),P=!p&&B(t,e),z=p&&N(t,s,e,o);(P||z)&&(i=J(t.options.networkMode)?"fetching":"paused",C||(a="loading")),e._optimisticResults==="isRestoring"&&(i="idle")}if(e.keepPreviousData&&!h.dataUpdatedAt&&g!=null&&g.isSuccess&&a!=="error")d=g.data,C=g.dataUpdatedAt,a=g.status,f=!0;else if(e.select&&typeof h.data<"u")if(u&&h.data===(c==null?void 0:c.data)&&e.select===this.selectFn)d=this.selectResult;else try{this.selectFn=e.select,d=e.select(h.data),d=L(u==null?void 0:u.data,d,e),this.selectResult=d,this.selectError=null}catch(p){this.selectError=p}else d=h.data;if(typeof e.placeholderData<"u"&&typeof d>"u"&&a==="loading"){let p;if(u!=null&&u.isPlaceholderData&&e.placeholderData===(y==null?void 0:y.placeholderData))p=u.data;else if(p=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof p<"u")try{p=e.select(p),this.selectError=null}catch(P){this.selectError=P}typeof p<"u"&&(a="success",d=L(u==null?void 0:u.data,p,e),b=!0)}this.selectError&&(Q=this.selectError,d=this.selectResult,n=Date.now(),a="error");const l=i==="fetching",R=a==="loading",S=a==="error";return{status:a,fetchStatus:i,isLoading:R,isSuccess:a==="success",isError:S,isInitialLoading:R&&l,data:d,dataUpdatedAt:C,error:Q,errorUpdatedAt:n,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>m.dataUpdateCount||h.errorUpdateCount>m.errorUpdateCount,isFetching:l,isRefetching:l&&!R,isLoadingError:S&&h.dataUpdatedAt===0,isPaused:i==="paused",isPlaceholderData:b,isPreviousData:f,isRefetchError:S&&h.dataUpdatedAt!==0,isStale:x(t,e),refetch:this.refetch,remove:this.remove}}updateResult(t){const e=this.currentResult,s=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,w(s,e))return;this.currentResult=s;const o={cache:!0},u=()=>{if(!e)return!0;const{notifyOnChangeProps:c}=this.options,y=typeof c=="function"?c():c;if(y==="all"||!y&&!this.trackedProps.size)return!0;const v=new Set(y??this.trackedProps);return this.options.useErrorBoundary&&v.add("error"),Object.keys(this.currentResult).some(m=>{const g=m;return this.currentResult[g]!==e[g]&&v.has(g)})};(t==null?void 0:t.listeners)!==!1&&u()&&(o.listeners=!0),this.notify({...o,...t})}updateQuery(){const t=this.client.getQueryCache().build(this.client,this.options);if(t===this.currentQuery)return;const e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}onQueryUpdate(t){const e={};t.type==="success"?e.onSuccess=!t.manual:t.type==="error"&&!X(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()}notify(t){O.batch(()=>{if(t.onSuccess){var e,s,o,u;(e=(s=this.options).onSuccess)==null||e.call(s,this.currentResult.data),(o=(u=this.options).onSettled)==null||o.call(u,this.currentResult.data,null)}else if(t.onError){var c,y,v,m;(c=(y=this.options).onError)==null||c.call(y,this.currentResult.error),(v=(m=this.options).onSettled)==null||v.call(m,void 0,this.currentResult.error)}t.listeners&&this.listeners.forEach(({listener:g})=>{g(this.currentResult)}),t.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function oe(r,t){return t.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&t.retryOnMount===!1)}function B(r,t){return oe(r,t)||r.state.dataUpdatedAt>0&&T(r,t,t.refetchOnMount)}function T(r,t,e){if(t.enabled!==!1){const s=typeof e=="function"?e(r):e;return s==="always"||s!==!1&&x(r,t)}return!1}function N(r,t,e,s){return e.enabled!==!1&&(r!==t||s.enabled===!1)&&(!e.suspense||r.state.status!=="error")&&x(r,e)}function x(r,t){return r.isStaleByTime(t.staleTime)}function ce(r,t,e){return e.keepPreviousData?!1:e.placeholderData!==void 0?t.isPlaceholderData:r.getCurrentResult()!==t}const j=E.createContext(!1),le=()=>E.useContext(j);j.Provider;function he(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}const fe=E.createContext(he()),de=()=>E.useContext(fe),pe=(r,t)=>{(r.suspense||r.useErrorBoundary)&&(t.isReset()||(r.retryOnMount=!1))},ye=r=>{E.useEffect(()=>{r.clearReset()},[r])},ve=({result:r,errorResetBoundary:t,useErrorBoundary:e,query:s})=>r.isError&&!t.isReset()&&!r.isFetching&&ie(e,[r.error,s]),me=r=>{r.suspense&&typeof r.staleTime!="number"&&(r.staleTime=1e3)},ge=(r,t)=>r.isLoading&&r.isFetching&&!t,Re=(r,t,e)=>(r==null?void 0:r.suspense)&&ge(t,e),be=(r,t,e)=>t.fetchOptimistic(r).then(({data:s})=>{r.onSuccess==null||r.onSuccess(s),r.onSettled==null||r.onSettled(s,null)}).catch(s=>{e.clearReset(),r.onError==null||r.onError(s),r.onSettled==null||r.onSettled(void 0,s)});function Se(r,t){const e=Y({context:r.context}),s=le(),o=de(),u=e.defaultQueryOptions(r);u._optimisticResults=s?"isRestoring":"optimistic",u.onError&&(u.onError=O.batchCalls(u.onError)),u.onSuccess&&(u.onSuccess=O.batchCalls(u.onSuccess)),u.onSettled&&(u.onSettled=O.batchCalls(u.onSettled)),me(u),pe(u,o),ye(o);const[c]=E.useState(()=>new t(e,u)),y=c.getOptimisticResult(u);if(ue(E.useCallback(v=>{const m=s?()=>{}:c.subscribe(O.batchCalls(v));return c.updateResult(),m},[c,s]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),E.useEffect(()=>{c.setOptions(u,{listeners:!1})},[u,c]),Re(u,y,s))throw be(u,c,o);if(ve({result:y,errorResetBoundary:o,useErrorBoundary:u.useErrorBoundary,query:c.getCurrentQuery()}))throw y.error;return u.notifyOnChangeProps?y:c.trackResult(y)}function Ee(r,t,e){const s=Z(r,t,e);return Se(s,ae)}function Ce(){const r=U();return E.useEffect(()=>{const t=r.at(-1);if(!t)return;const e=t.handle,s=e==null?void 0:e.title;typeof s=="string"&&(document.title=s)},[r])}var q={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(r,t){(function(e,s){r.exports=s()})(re,function(){var e={};e.version="0.2.0";var s=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};e.configure=function(n){var i,a;for(i in n)a=n[i],a!==void 0&&n.hasOwnProperty(i)&&(s[i]=a);return this},e.status=null,e.set=function(n){var i=e.isStarted();n=o(n,s.minimum,1),e.status=n===1?null:n;var a=e.render(!i),f=a.querySelector(s.barSelector),b=s.speed,d=s.easing;return a.offsetWidth,y(function(l){s.positionUsing===""&&(s.positionUsing=e.getPositioningCSS()),v(f,c(n,b,d)),n===1?(v(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout(function(){v(a,{transition:"all "+b+"ms linear",opacity:0}),setTimeout(function(){e.remove(),l()},b)},b)):setTimeout(l,b)}),this},e.isStarted=function(){return typeof e.status=="number"},e.start=function(){e.status||e.set(0);var n=function(){setTimeout(function(){e.status&&(e.trickle(),n())},s.trickleSpeed)};return s.trickle&&n(),this},e.done=function(n){return!n&&!e.status?this:e.inc(.3+.5*Math.random()).set(1)},e.inc=function(n){var i=e.status;return i?(typeof n!="number"&&(n=(1-i)*o(Math.random()*i,.1,.95)),i=o(i+n,0,.994),e.set(i)):e.start()},e.trickle=function(){return e.inc(Math.random()*s.trickleRate)},function(){var n=0,i=0;e.promise=function(a){return!a||a.state()==="resolved"?this:(i===0&&e.start(),n++,i++,a.always(function(){i--,i===0?(n=0,e.done()):e.set((n-i)/n)}),this)}}(),e.render=function(n){if(e.isRendered())return document.getElementById("nprogress");g(document.documentElement,"nprogress-busy");var i=document.createElement("div");i.id="nprogress",i.innerHTML=s.template;var a=i.querySelector(s.barSelector),f=n?"-100":u(e.status||0),b=document.querySelector(s.parent),d;return v(a,{transition:"all 0 linear",transform:"translate3d("+f+"%,0,0)"}),s.showSpinner||(d=i.querySelector(s.spinnerSelector),d&&Q(d)),b!=document.body&&g(b,"nprogress-custom-parent"),b.appendChild(i),i},e.remove=function(){h(document.documentElement,"nprogress-busy"),h(document.querySelector(s.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&Q(n)},e.isRendered=function(){return!!document.getElementById("nprogress")},e.getPositioningCSS=function(){var n=document.body.style,i="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return i+"Perspective"in n?"translate3d":i+"Transform"in n?"translate":"margin"};function o(n,i,a){return n<i?i:n>a?a:n}function u(n){return(-1+n)*100}function c(n,i,a){var f;return s.positionUsing==="translate3d"?f={transform:"translate3d("+u(n)+"%,0,0)"}:s.positionUsing==="translate"?f={transform:"translate("+u(n)+"%,0)"}:f={"margin-left":u(n)+"%"},f.transition="all "+i+"ms "+a,f}var y=function(){var n=[];function i(){var a=n.shift();a&&a(i)}return function(a){n.push(a),n.length==1&&i()}}(),v=function(){var n=["Webkit","O","Moz","ms"],i={};function a(l){return l.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(R,S){return S.toUpperCase()})}function f(l){var R=document.body.style;if(l in R)return l;for(var S=n.length,I=l.charAt(0).toUpperCase()+l.slice(1),p;S--;)if(p=n[S]+I,p in R)return p;return l}function b(l){return l=a(l),i[l]||(i[l]=f(l))}function d(l,R,S){R=b(R),l.style[R]=S}return function(l,R){var S=arguments,I,p;if(S.length==2)for(I in R)p=R[I],p!==void 0&&R.hasOwnProperty(I)&&d(l,I,p);else d(l,S[1],S[2])}}();function m(n,i){var a=typeof n=="string"?n:C(n);return a.indexOf(" "+i+" ")>=0}function g(n,i){var a=C(n),f=a+i;m(a,i)||(n.className=f.substring(1))}function h(n,i){var a=C(n),f;m(n,i)&&(f=a.replace(" "+i+" "," "),n.className=f.substring(1,f.length-1))}function C(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function Q(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return e})})(q);var Qe=q.exports;const W=se(Qe);function Ie(){const r=U();return E.useEffect(()=>(W.done(),()=>{W.start()}),[r])}const Oe=["login"],Pe=r=>Oe.includes(r);function Te(){const r=_(),t=U(),[e]=$(),s=t[t.length-1],o=ee(u=>u.login.usr);return E.useMemo(()=>{const{id:u,pathname:c}=s;if(u==="login"){const Q=e.get("returnURL")||"/";return o?A.createElement(M,{to:Q}):r}if(Pe(u)||o)return r;const m=new URLSearchParams;m.set("returnURL",c);const h={pathname:"/login",search:m.toString()};return A.createElement(M,{to:h})},[r,t,e,o])}function Ue(r){return te({url:"/usr",...r})}function xe(){const{usr:r,signIn:t,signOut:e}=ne(),{isError:s,data:o}=Ee({enabled:!!r,queryKey:["usr_get"],queryFn({signal:u}){return Ue({signal:u})},initialData(){return r},initialDataUpdatedAt(){return r==null?void 0:r.loginAt},refetchInterval:1e3*30});E.useEffect(()=>{o&&t(o)},[o]),E.useEffect(()=>{s&&e()},[s])}function Me(){const r=Te();return Ce(),Ie(),xe(),D.jsx(D.Fragment,{children:r})}export{Me as Component};
