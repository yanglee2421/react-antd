import{S as H,s as w,n as G,i as F,a as k,t as J,f as X,c as Y,r as L,b as Z,d as O,u as _,p as $,e as U,g as ee,h as te,j as q,N as M,k as re,l as se,m as D,o as A}from"./index-f8d17fc4.js";import{r as E,f as ne,g as ie,c as B,m as ue}from"./antd-57ea9798.js";import{s as ae,u as oe}from"./utils-f7680590.js";class ce extends H{constructor(t,e){super(),this.client=t,this.options=e,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(e)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.currentQuery.addObserver(this),N(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return T(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return T(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(t,e){const s=this.options,o=this.currentQuery;if(this.options=this.client.defaultQueryOptions(t),w(s,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=s.queryKey),this.updateQuery();const i=this.hasListeners();i&&j(this.currentQuery,o,this.options,s)&&this.executeFetch(),this.updateResult(e),i&&(this.currentQuery!==o||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.updateStaleTimeout();const c=this.computeRefetchInterval();i&&(this.currentQuery!==o||this.options.enabled!==s.enabled||c!==this.currentRefetchInterval)&&this.updateRefetchInterval(c)}getOptimisticResult(t){const e=this.client.getQueryCache().build(this.client,t),s=this.createResult(e,t);return he(this,s,t)&&(this.currentResult=s,this.currentResultOptions=this.options,this.currentResultState=this.currentQuery.state),s}getCurrentResult(){return this.currentResult}trackResult(t){const e={};return Object.keys(t).forEach(s=>{Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(s),t[s])})}),e}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:t,...e}={}){return this.fetch({...e,meta:{refetchPage:t}})}fetchOptimistic(t){const e=this.client.defaultQueryOptions(t),s=this.client.getQueryCache().build(this.client,e);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,e))}fetch(t){var e;return this.executeFetch({...t,cancelRefetch:(e=t.cancelRefetch)!=null?e:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(t){this.updateQuery();let e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(G)),e}updateStaleTimeout(){if(this.clearStaleTimeout(),F||this.currentResult.isStale||!k(this.options.staleTime))return;const e=J(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},e)}computeRefetchInterval(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1}updateRefetchInterval(t){this.clearRefetchInterval(),this.currentRefetchInterval=t,!(F||this.options.enabled===!1||!k(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||X.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(t,e){const s=this.currentQuery,o=this.options,i=this.currentResult,c=this.currentResultState,y=this.currentResultOptions,m=t!==s,v=m?t.state:this.currentQueryInitialState,g=m?this.currentResult:this.previousQueryResult,{state:h}=t;let{dataUpdatedAt:C,error:Q,errorUpdatedAt:n,fetchStatus:u,status:a}=h,d=!1,b=!1,f;if(e._optimisticResults){const p=this.hasListeners(),P=!p&&N(t,e),V=p&&j(t,s,e,o);(P||V)&&(u=Y(t.options.networkMode)?"fetching":"paused",C||(a="loading")),e._optimisticResults==="isRestoring"&&(u="idle")}if(e.keepPreviousData&&!h.dataUpdatedAt&&g!=null&&g.isSuccess&&a!=="error")f=g.data,C=g.dataUpdatedAt,a=g.status,d=!0;else if(e.select&&typeof h.data<"u")if(i&&h.data===(c==null?void 0:c.data)&&e.select===this.selectFn)f=this.selectResult;else try{this.selectFn=e.select,f=e.select(h.data),f=L(i==null?void 0:i.data,f,e),this.selectResult=f,this.selectError=null}catch(p){this.selectError=p}else f=h.data;if(typeof e.placeholderData<"u"&&typeof f>"u"&&a==="loading"){let p;if(i!=null&&i.isPlaceholderData&&e.placeholderData===(y==null?void 0:y.placeholderData))p=i.data;else if(p=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof p<"u")try{p=e.select(p),this.selectError=null}catch(P){this.selectError=P}typeof p<"u"&&(a="success",f=L(i==null?void 0:i.data,p,e),b=!0)}this.selectError&&(Q=this.selectError,f=this.selectResult,n=Date.now(),a="error");const l=u==="fetching",R=a==="loading",S=a==="error";return{status:a,fetchStatus:u,isLoading:R,isSuccess:a==="success",isError:S,isInitialLoading:R&&l,data:f,dataUpdatedAt:C,error:Q,errorUpdatedAt:n,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>v.dataUpdateCount||h.errorUpdateCount>v.errorUpdateCount,isFetching:l,isRefetching:l&&!R,isLoadingError:S&&h.dataUpdatedAt===0,isPaused:u==="paused",isPlaceholderData:b,isPreviousData:d,isRefetchError:S&&h.dataUpdatedAt!==0,isStale:x(t,e),refetch:this.refetch,remove:this.remove}}updateResult(t){const e=this.currentResult,s=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,w(s,e))return;this.currentResult=s;const o={cache:!0},i=()=>{if(!e)return!0;const{notifyOnChangeProps:c}=this.options,y=typeof c=="function"?c():c;if(y==="all"||!y&&!this.trackedProps.size)return!0;const m=new Set(y??this.trackedProps);return this.options.useErrorBoundary&&m.add("error"),Object.keys(this.currentResult).some(v=>{const g=v;return this.currentResult[g]!==e[g]&&m.has(g)})};(t==null?void 0:t.listeners)!==!1&&i()&&(o.listeners=!0),this.notify({...o,...t})}updateQuery(){const t=this.client.getQueryCache().build(this.client,this.options);if(t===this.currentQuery)return;const e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}onQueryUpdate(t){const e={};t.type==="success"?e.onSuccess=!t.manual:t.type==="error"&&!Z(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()}notify(t){O.batch(()=>{if(t.onSuccess){var e,s,o,i;(e=(s=this.options).onSuccess)==null||e.call(s,this.currentResult.data),(o=(i=this.options).onSettled)==null||o.call(i,this.currentResult.data,null)}else if(t.onError){var c,y,m,v;(c=(y=this.options).onError)==null||c.call(y,this.currentResult.error),(m=(v=this.options).onSettled)==null||m.call(v,void 0,this.currentResult.error)}t.listeners&&this.listeners.forEach(({listener:g})=>{g(this.currentResult)}),t.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function le(r,t){return t.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&t.retryOnMount===!1)}function N(r,t){return le(r,t)||r.state.dataUpdatedAt>0&&T(r,t,t.refetchOnMount)}function T(r,t,e){if(t.enabled!==!1){const s=typeof e=="function"?e(r):e;return s==="always"||s!==!1&&x(r,t)}return!1}function j(r,t,e,s){return e.enabled!==!1&&(r!==t||s.enabled===!1)&&(!e.suspense||r.state.status!=="error")&&x(r,e)}function x(r,t){return r.isStaleByTime(t.staleTime)}function he(r,t,e){return e.keepPreviousData?!1:e.placeholderData!==void 0?t.isPlaceholderData:r.getCurrentResult()!==t}const z=E.createContext(!1),de=()=>E.useContext(z);z.Provider;function fe(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}const pe=E.createContext(fe()),ye=()=>E.useContext(pe),me=(r,t)=>{(r.suspense||r.useErrorBoundary)&&(t.isReset()||(r.retryOnMount=!1))},ve=r=>{E.useEffect(()=>{r.clearReset()},[r])},ge=({result:r,errorResetBoundary:t,useErrorBoundary:e,query:s})=>r.isError&&!t.isReset()&&!r.isFetching&&ae(e,[r.error,s]),Re=r=>{r.suspense&&typeof r.staleTime!="number"&&(r.staleTime=1e3)},be=(r,t)=>r.isLoading&&r.isFetching&&!t,Se=(r,t,e)=>(r==null?void 0:r.suspense)&&be(t,e),Ee=(r,t,e)=>t.fetchOptimistic(r).then(({data:s})=>{r.onSuccess==null||r.onSuccess(s),r.onSettled==null||r.onSettled(s,null)}).catch(s=>{e.clearReset(),r.onError==null||r.onError(s),r.onSettled==null||r.onSettled(void 0,s)});function Ce(r,t){const e=_({context:r.context}),s=de(),o=ye(),i=e.defaultQueryOptions(r);i._optimisticResults=s?"isRestoring":"optimistic",i.onError&&(i.onError=O.batchCalls(i.onError)),i.onSuccess&&(i.onSuccess=O.batchCalls(i.onSuccess)),i.onSettled&&(i.onSettled=O.batchCalls(i.onSettled)),Re(i),me(i,o),ve(o);const[c]=E.useState(()=>new t(e,i)),y=c.getOptimisticResult(i);if(oe(E.useCallback(m=>{const v=s?()=>{}:c.subscribe(O.batchCalls(m));return c.updateResult(),v},[c,s]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),E.useEffect(()=>{c.setOptions(i,{listeners:!1})},[i,c]),Se(i,y,s))throw Ee(i,c,o);if(ge({result:y,errorResetBoundary:o,useErrorBoundary:i.useErrorBoundary,query:c.getCurrentQuery()}))throw y.error;return i.notifyOnChangeProps?y:c.trackResult(y)}function Qe(r,t,e){const s=$(r,t,e);return Ce(s,ce)}function Ie(){const r=U();return E.useEffect(()=>{const t=r.at(-1);if(!t)return;const{handle:e}=t,s=Reflect.get(Object(e),"title");typeof s=="string"&&(document.title=s)},[r])}var K={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(r,t){(function(e,s){r.exports=s()})(ne,function(){var e={};e.version="0.2.0";var s=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};e.configure=function(n){var u,a;for(u in n)a=n[u],a!==void 0&&n.hasOwnProperty(u)&&(s[u]=a);return this},e.status=null,e.set=function(n){var u=e.isStarted();n=o(n,s.minimum,1),e.status=n===1?null:n;var a=e.render(!u),d=a.querySelector(s.barSelector),b=s.speed,f=s.easing;return a.offsetWidth,y(function(l){s.positionUsing===""&&(s.positionUsing=e.getPositioningCSS()),m(d,c(n,b,f)),n===1?(m(a,{transition:"none",opacity:1}),a.offsetWidth,setTimeout(function(){m(a,{transition:"all "+b+"ms linear",opacity:0}),setTimeout(function(){e.remove(),l()},b)},b)):setTimeout(l,b)}),this},e.isStarted=function(){return typeof e.status=="number"},e.start=function(){e.status||e.set(0);var n=function(){setTimeout(function(){e.status&&(e.trickle(),n())},s.trickleSpeed)};return s.trickle&&n(),this},e.done=function(n){return!n&&!e.status?this:e.inc(.3+.5*Math.random()).set(1)},e.inc=function(n){var u=e.status;return u?(typeof n!="number"&&(n=(1-u)*o(Math.random()*u,.1,.95)),u=o(u+n,0,.994),e.set(u)):e.start()},e.trickle=function(){return e.inc(Math.random()*s.trickleRate)},function(){var n=0,u=0;e.promise=function(a){return!a||a.state()==="resolved"?this:(u===0&&e.start(),n++,u++,a.always(function(){u--,u===0?(n=0,e.done()):e.set((n-u)/n)}),this)}}(),e.render=function(n){if(e.isRendered())return document.getElementById("nprogress");g(document.documentElement,"nprogress-busy");var u=document.createElement("div");u.id="nprogress",u.innerHTML=s.template;var a=u.querySelector(s.barSelector),d=n?"-100":i(e.status||0),b=document.querySelector(s.parent),f;return m(a,{transition:"all 0 linear",transform:"translate3d("+d+"%,0,0)"}),s.showSpinner||(f=u.querySelector(s.spinnerSelector),f&&Q(f)),b!=document.body&&g(b,"nprogress-custom-parent"),b.appendChild(u),u},e.remove=function(){h(document.documentElement,"nprogress-busy"),h(document.querySelector(s.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&Q(n)},e.isRendered=function(){return!!document.getElementById("nprogress")},e.getPositioningCSS=function(){var n=document.body.style,u="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return u+"Perspective"in n?"translate3d":u+"Transform"in n?"translate":"margin"};function o(n,u,a){return n<u?u:n>a?a:n}function i(n){return(-1+n)*100}function c(n,u,a){var d;return s.positionUsing==="translate3d"?d={transform:"translate3d("+i(n)+"%,0,0)"}:s.positionUsing==="translate"?d={transform:"translate("+i(n)+"%,0)"}:d={"margin-left":i(n)+"%"},d.transition="all "+u+"ms "+a,d}var y=function(){var n=[];function u(){var a=n.shift();a&&a(u)}return function(a){n.push(a),n.length==1&&u()}}(),m=function(){var n=["Webkit","O","Moz","ms"],u={};function a(l){return l.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(R,S){return S.toUpperCase()})}function d(l){var R=document.body.style;if(l in R)return l;for(var S=n.length,I=l.charAt(0).toUpperCase()+l.slice(1),p;S--;)if(p=n[S]+I,p in R)return p;return l}function b(l){return l=a(l),u[l]||(u[l]=d(l))}function f(l,R,S){R=b(R),l.style[R]=S}return function(l,R){var S=arguments,I,p;if(S.length==2)for(I in R)p=R[I],p!==void 0&&R.hasOwnProperty(I)&&f(l,I,p);else f(l,S[1],S[2])}}();function v(n,u){var a=typeof n=="string"?n:C(n);return a.indexOf(" "+u+" ")>=0}function g(n,u){var a=C(n),d=a+u;v(a,u)||(n.className=d.substring(1))}function h(n,u){var a=C(n),d;v(n,u)&&(d=a.replace(" "+u+" "," "),n.className=d.substring(1,d.length-1))}function C(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function Q(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return e})})(K);var Oe=K.exports;const W=ie(Oe);function Pe(){const r=U();return E.useEffect(()=>(W.done(),()=>{W.start()}),[r])}const Te=["login"],Ue=r=>Te.includes(r);function xe(){const r=ee(),t=U(),[e]=te(),s=q(o=>o.login.usr);return E.useMemo(()=>{const o=t[t.length-1],{id:i,pathname:c}=o;if(i==="login"){const Q=e.get("returnURL")||"/";return s?B.createElement(M,{to:Q}):r}if(Ue(i)||s)return r;const v=new URLSearchParams;v.set("returnURL",c);const h={pathname:"/login",search:v.toString()};return B.createElement(M,{to:h})},[r,t,e,s])}function we(r){return re({url:"/usr",...r})}function Fe(){const r=se(),t=q(i=>i.login.usr),{isError:e,error:s,data:o}=Qe({enabled:!!t,queryKey:["usr_get"],queryFn({signal:i}){return we({signal:i,params:t})},initialData(){if(t)return t},initialDataUpdatedAt(){return t==null?void 0:t.loginAt},refetchInterval:1e3*60*30,retry:2,retryDelay:1e3*3});E.useEffect(()=>{if(!o)return;const i=D.actions.usrPatch(o);r(i)},[r,o]),E.useEffect(()=>{if(!e)return;const i=D.actions.usr(null);r(i),ue.error(s.message)},[r,e])}function De(){const r=xe();return Ie(),Pe(),Fe(),A.jsx(A.Fragment,{children:r})}export{De as Component};
